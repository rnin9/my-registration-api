---
openapi: 3.0.1
info:
  title: Registration API
  version: v1
  description: API for Users, Tests, and Courses
servers:
- url: http://localhost:3000
  description: Development server
components:
  securitySchemes:
    Bearer:
      type: http
      scheme: bearer
      bearerFormat: JWT
paths:
  "/auth/sign-in":
    post:
      summary: Sign in
      tags:
      - Auth
      parameters: []
      responses:
        '200':
          description: success
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                auth:
                  type: object
                  properties:
                    email:
                      type: string
                    password:
                      type: string
  "/auth/me":
    get:
      summary: Get current user
      tags:
      - Auth
      security:
      - Bearer: []
      responses:
        '200':
          description: success
  "/auth/sign-out":
    delete:
      summary: Sign out
      tags:
      - Auth
      security:
      - Bearer: []
      responses:
        '204':
          description: signed out
  "/courses":
    get:
      summary: List courses
      tags:
      - Courses
      parameters:
      - name: status
        in: query
        description: Filter by status (AVAILABLE, IN_PROGRESS, COMPLETED, CANCELLED)
        schema:
          type: string
      - name: sort
        in: query
        description: Sort by (created, popular)
        schema:
          type: string
      - name: skip
        in: query
        description: Offset for pagination
        schema:
          type: integer
      - name: limit
        in: query
        description: Limit for pagination
        schema:
          type: integer
      responses:
        '200':
          description: success
    post:
      summary: Create course
      tags:
      - Courses
      security:
      - Bearer: []
      parameters: []
      responses:
        '201':
          description: created
        '422':
          description: invalid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                course:
                  type: object
                  properties:
                    title:
                      type: string
                    description:
                      type: string
                    start_at:
                      type: string
                      format: date-time
                    end_at:
                      type: string
                      format: date-time
                    status:
                      type: string
                      enum:
                      - available
                      - in_progress
                      - completed
                      - cancelled
                  required:
                  - title
                  - description
                  - start_at
                  - end_at
                  - status
  "/courses/{id}":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    get:
      summary: Get course
      tags:
      - Courses
      responses:
        '200':
          description: success
        '404':
          description: not found
    patch:
      summary: Update course
      tags:
      - Courses
      security:
      - Bearer: []
      parameters: []
      responses:
        '200':
          description: updated
        '403':
          description: forbidden
        '404':
          description: not found
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                course:
                  type: object
                  properties:
                    title:
                      type: string
                    description:
                      type: string
                    student_count:
                      type: integer
                    start_at:
                      type: string
                      format: date-time
                    end_at:
                      type: string
                      format: date-time
                    status:
                      type: string
                    is_destroyed:
                      type: boolean
    delete:
      summary: Delete course
      tags:
      - Courses
      security:
      - Bearer: []
      responses:
        '204':
          description: deleted
        '403':
          description: forbidden
  "/courses/{id}/restore":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: Restore course
      tags:
      - Courses
      security:
      - Bearer: []
      responses:
        '200':
          description: restored
        '404':
          description: not found
  "/courses/{id}/apply":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: Apply for course (create payment)
      tags:
      - Courses
      security:
      - Bearer: []
      description: Create a payment for a course
      parameters: []
      responses:
        '201':
          description: payment created
        '404':
          description: course not found
        '422':
          description: invalid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: integer
                method:
                  type: string
                  enum:
                  - card
                  - bank_transfer
                  - virtual_account
                  - mobile
                  - kakaopay
                  - naverpay
              required:
              - amount
              - method
  "/payments":
    get:
      summary: List payments
      tags:
      - Payments
      security:
      - Bearer: []
      parameters:
      - name: status
        in: query
        required: false
        description: Filter by status (PENDING, COMPLETED, CANCELLED, FAILED, REFUNDED)
        schema:
          type: string
      - name: from
        in: query
        format: date
        required: false
        description: Filter from date (YYYY-MM-DD)
        schema:
          type: string
      - name: to
        in: query
        format: date
        required: false
        description: Filter to date (YYYY-MM-DD)
        schema:
          type: string
      - name: skip
        in: query
        required: false
        description: Offset for pagination
        schema:
          type: integer
      - name: limit
        in: query
        required: false
        description: Limit for pagination
        schema:
          type: integer
      responses:
        '200':
          description: success
    post:
      summary: Create payment
      tags:
      - Payments
      security:
      - Bearer: []
      parameters: []
      responses:
        '201':
          description: created
        '422':
          description: invalid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                payment:
                  type: object
                  properties:
                    actant_id:
                      type: string
                      format: uuid
                    amount:
                      type: integer
                    method:
                      type: string
                      enum:
                      - card
                      - bank_transfer
                      - virtual_account
                      - mobile
                      - kakaopay
                      - naverpay
                      nullable: true
                    status:
                      type: string
                      enum:
                      - pending
                      - completed
                      - cancelled
                      - failed
                      - refunded
                    target_type:
                      type: string
                      enum:
                      - test
                      - course
                    target_id:
                      type: string
                    title:
                      type: string
                    paid_at:
                      type: string
                      format: date-time
                      nullable: true
                    valid_from:
                      type: string
                      format: date
                    valid_to:
                      type: string
                      format: date
                  required:
                  - actant_id
                  - amount
                  - status
                  - target_type
                  - target_id
                  - title
                  - valid_from
                  - valid_to
  "/payments/my":
    get:
      summary: Get my payments
      tags:
      - Payments
      security:
      - Bearer: []
      parameters:
      - name: status
        in: query
        required: false
        schema:
          type: string
      - name: from
        in: query
        format: date
        required: false
        schema:
          type: string
      - name: to
        in: query
        format: date
        required: false
        schema:
          type: string
      - name: skip
        in: query
        required: false
        schema:
          type: integer
      - name: limit
        in: query
        required: false
        schema:
          type: integer
      responses:
        '200':
          description: success
  "/payments/{id}":
    parameters:
    - name: id
      in: path
      format: uuid
      required: true
      schema:
        type: string
    get:
      summary: Get payment
      tags:
      - Payments
      security:
      - Bearer: []
      responses:
        '200':
          description: success
        '404':
          description: not found
    patch:
      summary: Update payment
      tags:
      - Payments
      security:
      - Bearer: []
      parameters: []
      responses:
        '200':
          description: updated
        '403':
          description: forbidden
        '404':
          description: not found
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                payment:
                  type: object
                  properties:
                    amount:
                      type: integer
                    method:
                      type: string
                      enum:
                      - card
                      - bank_transfer
                      - virtual_account
                      - mobile
                      - kakaopay
                      - naverpay
                      nullable: true
                    status:
                      type: string
                      enum:
                      - pending
                      - completed
                      - cancelled
                      - failed
                      - refunded
                    target_type:
                      type: string
                      enum:
                      - test
                      - course
                    target_id:
                      type: string
                    title:
                      type: string
                    paid_at:
                      type: string
                      format: date-time
                      nullable: true
                    cancelled_at:
                      type: string
                      format: date-time
                      nullable: true
                    valid_from:
                      type: string
                      format: date
                    valid_to:
                      type: string
                      format: date
                    is_destroyed:
                      type: boolean
    delete:
      summary: Delete payment
      tags:
      - Payments
      security:
      - Bearer: []
      responses:
        '204':
          description: deleted
        '403':
          description: forbidden
  "/payments/{id}/restore":
    parameters:
    - name: id
      in: path
      format: uuid
      required: true
      schema:
        type: string
    post:
      summary: Restore payment
      tags:
      - Payments
      security:
      - Bearer: []
      responses:
        '200':
          description: restored
        '404':
          description: not found
  "/payments/{id}/cancel":
    parameters:
    - name: id
      in: path
      format: uuid
      required: true
      schema:
        type: string
    post:
      summary: Cancel payment
      tags:
      - Payments
      security:
      - Bearer: []
      description: Cancel a payment and set cancelled_at timestamp
      responses:
        '200':
          description: cancelled
        '403':
          description: forbidden
        '404':
          description: not found
  "/payments/{id}/complete":
    parameters:
    - name: id
      in: path
      format: uuid
      required: true
      schema:
        type: string
    post:
      summary: Complete payment
      tags:
      - Payments
      security:
      - Bearer: []
      description: Mark payment as completed and set paid_at timestamp
      responses:
        '200':
          description: completed
        '403':
          description: forbidden
        '404':
          description: not found
  "/tests":
    get:
      summary: List tests
      tags:
      - Tests
      parameters:
      - name: status
        in: query
        description: Filter by status (AVAILABLE, IN_PROGRESS, COMPLETED, CANCELLED)
        schema:
          type: string
      - name: sort
        in: query
        description: Sort by (created, popular)
        schema:
          type: string
      - name: skip
        in: query
        description: Offset for pagination
        schema:
          type: integer
      - name: limit
        in: query
        description: Limit for pagination
        schema:
          type: integer
      responses:
        '200':
          description: success
    post:
      summary: Create test
      tags:
      - Tests
      security:
      - Bearer: []
      parameters: []
      responses:
        '201':
          description: created
        '422':
          description: invalid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                test:
                  type: object
                  properties:
                    title:
                      type: string
                    description:
                      type: string
                    start_at:
                      type: string
                      format: date-time
                    end_at:
                      type: string
                      format: date-time
                    status:
                      type: string
                      enum:
                      - available
                      - in_progress
                      - completed
                      - cancelled
                  required:
                  - title
                  - description
                  - start_at
                  - end_at
                  - status
  "/tests/{id}":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    get:
      summary: Get test
      tags:
      - Tests
      responses:
        '200':
          description: success
        '404':
          description: not found
    patch:
      summary: Update test
      tags:
      - Tests
      security:
      - Bearer: []
      parameters: []
      responses:
        '200':
          description: updated
        '403':
          description: forbidden
        '404':
          description: not found
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                test:
                  type: object
                  properties:
                    title:
                      type: string
                    description:
                      type: string
                    examinee_count:
                      type: integer
                    start_at:
                      type: string
                      format: date-time
                    end_at:
                      type: string
                      format: date-time
                    status:
                      type: string
                    is_destroyed:
                      type: boolean
    delete:
      summary: Delete test
      tags:
      - Tests
      security:
      - Bearer: []
      responses:
        '204':
          description: deleted
        '403':
          description: forbidden
  "/tests/{id}/restore":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: Restore test
      tags:
      - Tests
      security:
      - Bearer: []
      responses:
        '200':
          description: restored
        '404':
          description: not found
  "/tests/{id}/apply":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: Apply for test (create payment)
      tags:
      - Tests
      security:
      - Bearer: []
      description: Create a payment for a test
      parameters: []
      responses:
        '201':
          description: payment created
        '404':
          description: test not found
        '422':
          description: invalid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: integer
                method:
                  type: string
                  enum:
                  - card
                  - bank_transfer
                  - virtual_account
                  - mobile
                  - kakaopay
                  - naverpay
              required:
              - amount
              - method
  "/users":
    get:
      summary: List users
      tags:
      - Users
      responses:
        '200':
          description: success
    post:
      summary: Create user (Sign up)
      tags:
      - Users
      parameters: []
      responses:
        '201':
          description: created
        '422':
          description: invalid
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    email:
                      type: string
                    name:
                      type: string
                    password:
                      type: string
                    password_confirmation:
                      type: string
                  required:
                  - email
                  - name
                  - password
                  - password_confirmation
  "/users/{id}":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    get:
      summary: Get user
      tags:
      - Users
      responses:
        '200':
          description: success
        '404':
          description: not found
    patch:
      summary: Update user
      tags:
      - Users
      security:
      - Bearer: []
      parameters: []
      responses:
        '200':
          description: updated
        '403':
          description: forbidden
      requestBody:
        content:
          application/json:
            schema:
              type: object
              properties:
                user:
                  type: object
                  properties:
                    name:
                      type: string
                    email:
                      type: string
    delete:
      summary: Delete user
      tags:
      - Users
      security:
      - Bearer: []
      responses:
        '204':
          description: deleted
        '403':
          description: forbidden
  "/users/{id}/restore":
    parameters:
    - name: id
      in: path
      required: true
      schema:
        type: integer
    post:
      summary: Restore user
      tags:
      - Users
      security:
      - Bearer: []
      responses:
        '200':
          description: restored
        '404':
          description: not found
